<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>HAPTIC QUANTUM INTERFACE</title>
    <style>
        body { margin: 0; background: #000; overflow: hidden; touch-action: none; font-family: sans-serif; }
        canvas { display: block; }
        
        /* 觸發時的螢幕紅光警告特效 */
        #glitch-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle, rgba(255,0,0,0.15) 0%, transparent 70%);
            opacity: 0; pointer-events: none; z-index: 10;
        }

        .instruction {
            position: fixed; top: 20px; width: 100%; text-align: center;
            color: rgba(0, 255, 255, 0.5); letter-spacing: 3px; font-size: 12px;
        }
    </style>
</head>
<body>

<div id="glitch-overlay"></div>
<div class="instruction">TOUCH TO ENGAGE HAPTIC ENGINE</div>

<script type="module">
    import * as THREE from 'https://cdn.skypack.dev/three@0.136.0';

    let scene, camera, renderer, particles, clock;
    const overlay = document.getElementById('glitch-overlay');

    init();
    animate();

    function init() {
        scene = new THREE.Scene();
        camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
        camera.position.z = 5;

        renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        // 創建動態力場粒子
        const geo = new THREE.BufferGeometry();
        const pos = [];
        for(let i=0; i<5000; i++) {
            pos.push((Math.random()-0.5)*10, (Math.random()-0.5)*10, (Math.random()-0.5)*10);
        }
        geo.setAttribute('position', new THREE.Float32Attribute(pos, 3));
        const mat = new THREE.PointsMaterial({ color: 0x00ffff, size: 0.02, transparent: true, blending: THREE.AdditiveBlending });
        particles = new THREE.Points(geo, mat);
        scene.add(particles);

        clock = new THREE.Clock();

        // --- 核心觸覺交互代碼 ---
        window.addEventListener('touchstart', handleTouch, { passive: false });
        window.addEventListener('mousedown', (e) => triggerHaptic(200)); 
    }

    function handleTouch(e) {
        e.preventDefault();
        // 1. 調用設備震動 (雙重震動模擬物理碰撞)
        if (navigator.vibrate) {
            navigator.vibrate([30, 50, 30]); 
        }
        
        // 2. 視覺反饋：螢幕抖動
        shakeScreen();
        
        // 3. 視覺反饋：紅光閃爍
        overlay.style.opacity = '1';
        setTimeout(() => overlay.style.opacity = '0', 150);
    }

    function triggerHaptic(ms) {
        if (navigator.vibrate) navigator.vibrate(ms);
        shakeScreen();
    }

    function shakeScreen() {
        const intensity = 5;
        const x = (Math.random() - 0.5) * intensity;
        const y = (Math.random() - 0.5) * intensity;
        renderer.domElement.style.transform = `translate(${x}px, ${y}px)`;
        setTimeout(() => renderer.domElement.style.transform = 'translate(0,0)', 50);
    }

    function animate() {
        requestAnimationFrame(animate);
        const t = clock.getElapsedTime();
        particles.rotation.y = t * 0.1;
        particles.rotation.x = t * 0.05;
        
        // 粒子隨時間產生呼吸感
        particles.material.size = 0.02 + Math.sin(t*5) * 0.01;
        
        renderer.render(scene, camera);
    }
</script>
</body>
</html>
